<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animal Fighting AR - Lion vs Tiger - Games Universe</title>
    <meta name="description" content="Experience Animal Fighting AR, a combat game where legendary predators clash in an AR arena powered by AI and blockchain.">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="modal.css">
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
</head>
<body>
    <header>
        <h1>Animal Fighting AR</h1>
    </header>
    <nav>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="vrar_games.html">AR/VR Games</a></li>
            <li><a href="battle_and_fight_games.html">Battle Games</a></li>
            <li><a href="paywell.html">Paywell Wallet</a></li>
        </ul>
    </nav>
    <main>
        <section id="game-overview">
            <h2>Combat Arena</h2>
            <p>Enter the arena where the world's most powerful predators face off. Witness the ultimate clash between the Lion and the Tiger in stunning AR. Use AI insights to master the fight and claim your Champion NFT.</p>
        </section>

        <section id="fighter-selection" style="text-align: center; margin-bottom: 20px;">
            <h3>Choose Your Fighter</h3>
            <button onclick="selectFighter('lion')">Select Lion</button>
            <button onclick="selectFighter('tiger')">Select Tiger</button>
            <p>Currently Playing As: <strong id="selected-fighter">Lion</strong></p>
        </section>

        <section id="game-scene" style="height: 500px; position: relative;">
            <h3>The Arena (AR/VR)</h3>
            <a-scene embedded style="height: 100%; width: 100%;">
                <a-assets>
                    <img id="arena-floor" src="https://cdn.aframe.io/a-painter/images/floor.jpg">
                </a-assets>

                <a-sky color="#87CEEB"></a-sky>
                <a-plane position="0 0 0" rotation="-90 0 0" width="20" height="20" src="#arena-floor"></a-plane>

                <!-- Fighter 1: Lion -->
                <a-entity id="lion-fighter" position="-2 0.5 -5" rotation="0 45 0">
                    <a-box position="0 0.5 0" width="1" height="1.2" depth="1.8" color="orange"></a-box>
                    <a-sphere position="0 1.5 1" radius="0.5" color="orange"></a-sphere> <!-- Head -->
                    <a-cylinder position="0 1.5 1" radius="0.6" height="0.3" rotation="90 0 0" color="brown"></a-cylinder> <!-- Mane -->
                    <a-text value="LION" position="0 2.5 0" align="center" color="black"></a-text>
                </a-entity>

                <!-- Fighter 2: Tiger -->
                <a-entity id="tiger-fighter" position="2 0.5 -5" rotation="0 -45 0">
                    <a-box position="0 0.5 0" width="1" height="1.2" depth="1.8" color="orange"></a-box>
                    <!-- Stripes -->
                    <a-box position="0 0.7 0.2" width="1.1" height="0.1" depth="0.1" color="black"></a-box>
                    <a-box position="0 0.7 -0.2" width="1.1" height="0.1" depth="0.1" color="black"></a-box>
                    <a-sphere position="0 1.5 1" radius="0.5" color="orange"></a-sphere> <!-- Head -->
                    <a-text value="TIGER" position="0 2.5 0" align="center" color="black"></a-text>
                </a-entity>

                <a-entity camera look-controls position="0 2 0">
                    <a-cursor fuse="false" color="red"></a-cursor>
                </a-entity>
            </a-scene>
            <p style="text-align: center; font-style: italic;">The predators are ready. Fight!</p>
        </section>

        <section id="ai-coach">
            <h3>AI Combat Coach</h3>
            <p>Get real-time tactical advice from our AI engine.</p>
            <div style="margin-bottom: 10px;">
                <button onclick="getAiAction('ready')">Analyze Opponent</button>
                <button onclick="getAiAction('attacking')">Prepare Attack</button>
                <button onclick="getAiAction('defending')">Brace for Impact</button>
                <button onclick="getAiAction('near_victory')">Finishing Move</button>
            </div>
            <p><strong>AI Coach Says:</strong> <span id="ai-action">Waiting for combat to begin...</span></p>
        </section>

        <section id="blockchain-reward">
            <h3>Champion's Spoils</h3>
            <p>If you emerge victorious, enter your wallet address to claim your Animal Fighting Champion NFT.</p>
            <input type="text" id="wallet-address" placeholder="Enter Wallet Address (0x...)">
            <button onclick="claimReward()">Claim Champion NFT</button>
            <div id="reward-status"></div>
        </section>

        <section id="nft-viewer">
            <h3>Hall of Fame</h3>
            <p>View your hard-earned combat trophies.</p>
            <input type="number" id="nft-token-id" placeholder="Enter Token ID">
            <button onclick="getNftDetails()">View Trophy</button>
            <div id="nft-details"></div>
        </section>
    </main>
    <footer>
        <p>&copy; 2024 Games Universe</p>
    </footer>
    <script src="modal.js" defer></script>
    <script>
        const API_KEY = "test-api-key";
        let selectedFighter = 'lion';
        let opponent = 'tiger';

        function selectFighter(fighter) {
            selectedFighter = fighter;
            opponent = (fighter === 'lion') ? 'tiger' : 'lion';
            document.getElementById('selected-fighter').textContent = fighter.charAt(0).toUpperCase() + fighter.slice(1);

            // Visual feedback in A-Frame
            const lion = document.getElementById('lion-fighter');
            const tiger = document.getElementById('tiger-fighter');

            if (fighter === 'lion') {
                lion.setAttribute('scale', '1.2 1.2 1.2');
                tiger.setAttribute('scale', '1 1 1');
            } else {
                tiger.setAttribute('scale', '1.2 1.2 1.2');
                lion.setAttribute('scale', '1 1 1');
            }
        }

        async function getAiAction(state) {
            const response = await fetch('/api/animal_fighting/ai/action', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-API-Key': API_KEY
                },
                body: JSON.stringify({
                    game_state: state,
                    animal_type: selectedFighter,
                    opponent_type: opponent
                })
            });
            const data = await response.json();
            document.getElementById('ai-action').textContent = data.action;

            // Simple combat animation
            if (state === 'attacking') {
                const fighterEntity = document.getElementById(selectedFighter + '-fighter');
                fighterEntity.setAttribute('animation', 'property: position; to: 0 0.5 -5; dur: 300; dir: alternate; loop: 1');
            }
        }

        async function claimReward() {
            const address = document.getElementById('wallet-address').value;
            if (!address) {
                alert('Please enter a wallet address.');
                return;
            }
            const response = await fetch('/api/animal_fighting/reward', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-API-Key': API_KEY
                },
                body: JSON.stringify({
                    owner_address: address,
                    metadata_uri: "https://games-universe.com/rewards/animal_fighting_" + selectedFighter + ".json"
                })
            });
            const data = await response.json();
            const statusDiv = document.getElementById('reward-status');
            if (response.ok) {
                statusDiv.innerHTML = `<p style="color: green;">Victory! Champion Token ID: ${data.token_id} minted to ${data.owner}</p>`;
            } else {
                statusDiv.innerHTML = `<p style="color: red;">Error claiming reward.</p>`;
            }
        }

        async function getNftDetails() {
            const tokenId = document.getElementById('nft-token-id').value;
            if (!tokenId) {
                alert('Please enter a token ID.');
                return;
            }
            const response = await fetch(`/api/animal_fighting/nft/${tokenId}`, {
                headers: {
                    'X-API-Key': API_KEY
                }
            });
            const nftDetailsDiv = document.getElementById('nft-details');
            if (response.ok) {
                const data = await response.json();
                nftDetailsDiv.innerHTML = `
                    <div style="border: 1px solid #ccc; padding: 10px; margin-top: 10px;">
                        <p><strong>Champion:</strong> ${data.owner}</p>
                        <p><strong>Metadata URI:</strong> <a href="${data.uri}" target="_blank">${data.uri}</a></p>
                    </div>
                `;
            } else {
                nftDetailsDiv.innerHTML = `<p style="color: red;">Error: Trophy not found.</p>`;
            }
        }

        // Initial setup
        selectFighter('lion');
    </script>
</body>
</html>
