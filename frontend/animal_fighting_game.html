<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animal Fighting AR/VR - Games Universe</title>
    <meta name="description" content="Experience Animal Fighting AR/VR, where legendary animals clash in the arena using AI and blockchain technology.">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="modal.css">
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
</head>
<body>
    <header>
        <h1>Animal Fighting AR/VR</h1>
    </header>
    <nav>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="vrar_games.html">AR/VR Games</a></li>
            <li><a href="battle_and_fight_games.html">Battle Games</a></li>
            <li><a href="paywell.html">Paywell Wallet</a></li>
        </ul>
    </nav>
    <main>
        <section id="game-overview">
            <h2>Game Overview</h2>
            <p>Step into the ultimate arena! Choose your champion and face off against powerful rivals. Utilize AI-powered combat strategies and win exclusive Combat Champion NFTs on the blockchain.</p>
        </section>

        <section id="matchup-selection" style="text-align: center; margin-bottom: 20px;">
            <h3>Select Your Matchup</h3>
            <button onclick="selectMatchup('lion_vs_tiger')">Lion vs Tiger</button>
            <button onclick="selectMatchup('gorilla_vs_elephant')">Gorilla vs Elephant</button>
            <button onclick="selectMatchup('snake_vs_snake')">Snake vs Snake</button>
            <p>Current Fight: <strong id="current-matchup">Lion vs Tiger</strong></p>
        </section>

        <section id="game-scene" style="height: 600px; position: relative; border: 2px solid #333;">
            <h3>Combat Arena (AR/VR)</h3>
            <a-scene embedded style="height: 100%; width: 100%;">
                <a-assets>
                    <img id="arena-floor" src="https://cdn.aframe.io/a-painter/images/floor.jpg">
                </a-assets>

                <a-sky color="#87CEEB"></a-sky>
                <a-plane position="0 0 0" rotation="-90 0 0" width="20" height="20" src="#arena-floor"></a-plane>

                <!-- Player Animal -->
                <a-entity id="player-animal-entity" position="-2 0 -3">
                    <!-- Placeholder for animal -->
                </a-entity>

                <!-- Opponent Animal -->
                <a-entity id="opponent-animal-entity" position="2 0 -3" rotation="0 180 0">
                    <!-- Placeholder for animal -->
                </a-entity>

                <a-entity camera look-controls position="0 2 2">
                    <a-cursor fuse="false" color="red"></a-cursor>
                </a-entity>
            </a-scene>
            <p style="text-align: center; font-style: italic;">Use your mouse to look around. Prepare for battle!</p>
        </section>

        <section id="ai-demo">
            <h3>AI Combat Assistant</h3>
            <p>Get AI-powered tactical advice for your current fight.</p>
            <button onclick="getAiAction('fighting')">Attack Advice</button>
            <button onclick="getAiAction('defending')">Defense Strategy</button>
            <button onclick="simulateVictory()">Victory!</button>
            <p><strong>AI Combat Recommendation:</strong> <span id="ai-action">Wait for signal...</span></p>
        </section>

        <section id="blockchain-reward">
            <h3>Combat Champion Rewards</h3>
            <p>Claim your unique Combat Champion NFT if you emerge victorious!</p>
            <input type="text" id="wallet-address" placeholder="Enter Wallet Address (0x...)">
            <button onclick="claimReward()">Claim Champion NFT</button>
            <div id="reward-status"></div>
        </section>

        <section id="nft-viewer">
            <h3>Trophy Room</h3>
            <p>Enter your Champion token ID to view your trophy.</p>
            <input type="number" id="nft-token-id" placeholder="Enter Token ID">
            <button onclick="getNftDetails()">View Trophy</button>
            <div id="nft-details"></div>
        </section>
    </main>
    <footer>
        <p>&copy; 2024 Games Universe</p>
    </footer>
    <script src="modal.js" defer></script>
    <script>
        const API_KEY = "test-api-key";
        let currentPlayerAnimal = 'lion';
        let currentOpponentAnimal = 'tiger';
        let fightState = 'ready';

        const animalModels = {
            lion: `
                <a-box position="0 0.5 0" width="0.8" height="1" depth="1.5" color="orange"></a-box>
                <a-sphere position="0 1.2 0.8" radius="0.4" color="orange"></a-sphere>
                <a-cylinder position="0 1.2 0.8" radius="0.5" height="0.2" rotation="90 0 0" color="brown"></a-cylinder>
                <a-text value="Lion" position="0 2 0" align="center" color="black"></a-text>
            `,
            tiger: `
                <a-box position="0 0.5 0" width="0.8" height="1" depth="1.5" color="orange"></a-box>
                <a-box position="0 0.6 0.1" width="0.85" height="0.1" depth="0.1" color="black"></a-box>
                <a-box position="0 0.6 -0.1" width="0.85" height="0.1" depth="0.1" color="black"></a-box>
                <a-sphere position="0 1.2 0.8" radius="0.4" color="orange"></a-sphere>
                <a-text value="Tiger" position="0 2 0" align="center" color="black"></a-text>
            `,
            gorilla: `
                <a-box position="0 0.7 0" width="1.2" height="1.4" depth="1" color="#333"></a-box>
                <a-sphere position="0 1.6 0.4" radius="0.5" color="#222"></a-sphere>
                <a-box position="-0.7 0.5 0.3" width="0.4" height="1" depth="0.4" color="#333"></a-box>
                <a-box position="0.7 0.5 0.3" width="0.4" height="1" depth="0.4" color="#333"></a-box>
                <a-text value="Gorilla" position="0 2.5 0" align="center" color="white"></a-text>
            `,
            elephant: `
                <a-box position="0 1 0" width="2" height="2" depth="3" color="gray"></a-box>
                <a-sphere position="0 2 1.5" radius="0.8" color="gray"></a-sphere>
                <a-cylinder position="0 1.5 2.2" radius="0.2" height="1.5" rotation="-30 0 0" color="gray"></a-cylinder>
                <a-text value="Elephant" position="0 3.5 0" align="center" color="black"></a-text>
            `,
            snake: `
                <a-sphere position="0 0.2 0" radius="0.2" color="green"></a-sphere>
                <a-sphere position="0 0.2 0.4" radius="0.2" color="green"></a-sphere>
                <a-sphere position="0 0.2 0.8" radius="0.2" color="green"></a-sphere>
                <a-sphere position="0 0.4 1.2" radius="0.25" color="green"></a-sphere>
                <a-text value="Snake" position="0 1 0" align="center" color="black"></a-text>
            `
        };

        function selectMatchup(matchup) {
            const playerEl = document.getElementById('player-animal-entity');
            const opponentEl = document.getElementById('opponent-animal-entity');
            const matchupText = document.getElementById('current-matchup');

            if (matchup === 'lion_vs_tiger') {
                currentPlayerAnimal = 'lion';
                currentOpponentAnimal = 'tiger';
                matchupText.textContent = 'Lion vs Tiger';
            } else if (matchup === 'gorilla_vs_elephant') {
                currentPlayerAnimal = 'gorilla';
                currentOpponentAnimal = 'elephant';
                matchupText.textContent = 'Gorilla vs Elephant';
            } else if (matchup === 'snake_vs_snake') {
                currentPlayerAnimal = 'snake';
                currentOpponentAnimal = 'snake';
                matchupText.textContent = 'Snake vs Snake';
            }

            playerEl.innerHTML = animalModels[currentPlayerAnimal];
            opponentEl.innerHTML = animalModels[currentOpponentAnimal];
            fightState = 'ready';
            document.getElementById('ai-action').textContent = 'Wait for signal...';
        }

        async function getAiAction(state) {
            fightState = state;
            try {
                const response = await fetch('/api/animal_fighting/ai/action', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': API_KEY
                    },
                    body: JSON.stringify({
                        game_state: state,
                        player_animal: currentPlayerAnimal,
                        opponent_animal: currentOpponentAnimal
                    })
                });
                const data = await response.json();
                document.getElementById('ai-action').textContent = data.action;

                // Simple visual animation for attack
                if (state === 'fighting') {
                    const playerEl = document.getElementById('player-animal-entity');
                    playerEl.setAttribute('animation', 'property: position; to: -1 0 -3; dur: 200; dir: alternate; loop: 1');
                }
            } catch (error) {
                console.error('Error fetching AI action:', error);
            }
        }

        async function simulateVictory() {
            fightState = 'victory';
            const response = await fetch('/api/animal_fighting/ai/action', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-API-Key': API_KEY
                },
                body: JSON.stringify({
                    game_state: 'victory',
                    player_animal: currentPlayerAnimal,
                    opponent_animal: currentOpponentAnimal
                })
            });
            const data = await response.json();
            document.getElementById('ai-action').textContent = data.action;

            // Opponent falls over
            const opponentEl = document.getElementById('opponent-animal-entity');
            opponentEl.setAttribute('animation', 'property: rotation; to: 90 180 0; dur: 500; loop: 1');
        }

        async function claimReward() {
            const address = document.getElementById('wallet-address').value;
            if (!address) {
                alert('Please enter a wallet address.');
                return;
            }
            if (fightState !== 'victory') {
                alert('You must win the fight first!');
                return;
            }

            const response = await fetch('/api/animal_fighting/reward', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-API-Key': API_KEY
                },
                body: JSON.stringify({
                    owner_address: address,
                    metadata_uri: `https://games-universe.com/rewards/combat_champion_${currentPlayerAnimal}.json`
                })
            });
            const data = await response.json();
            const statusDiv = document.getElementById('reward-status');
            if (response.ok) {
                statusDiv.innerHTML = `<p style="color: green;">Congratulations! Combat Champion Token ID: ${data.token_id} minted to ${data.owner}</p>`;
            } else {
                statusDiv.innerHTML = `<p style="color: red;">Error claiming reward.</p>`;
            }
        }

        async function getNftDetails() {
            const tokenId = document.getElementById('nft-token-id').value;
            if (!tokenId) {
                alert('Please enter a token ID.');
                return;
            }
            const response = await fetch(`/api/animal_fighting/nft/${tokenId}`, {
                headers: {
                    'X-API-Key': API_KEY
                }
            });
            const nftDetailsDiv = document.getElementById('nft-details');
            if (response.ok) {
                const data = await response.json();
                nftDetailsDiv.innerHTML = `
                    <div style="border: 1px solid #ccc; padding: 10px; margin-top: 10px;">
                        <p><strong>Champion:</strong> ${data.owner}</p>
                        <p><strong>Trophy Metadata:</strong> <a href="${data.uri}" target="_blank">${data.uri}</a></p>
                    </div>
                `;
            } else {
                nftDetailsDiv.innerHTML = `<p style="color: red;">Error: Trophy not found.</p>`;
            }
        }

        // Initial setup
        window.onload = () => selectMatchup('lion_vs_tiger');
    </script>
</body>
</html>
