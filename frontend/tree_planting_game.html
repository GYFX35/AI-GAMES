<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tree Planting AR Game - Games Universe</title>
    <meta name="description" content="Experience Tree Planting AR, a game where you help reforest the world using AI and blockchain technology.">
    <meta name="keywords" content="AR game, VR game, Tree Planting, reforestation, blockchain, AI, game development">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="modal.css">
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
</head>
<body>
    <header>
        <h1>Tree Planting AR Game</h1>
    </header>
    <nav>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="vrar_games.html">AR/VR Games</a></li>
            <li><a href="ai_mmo_games.html">AI MMO Games</a></li>
            <li><a href="paywell.html">Paywell Wallet</a></li>
            <li><a href="tree_planting_game.html">Tree Planting</a></li>
        </ul>
    </nav>
    <main>
        <section id="game-overview">
            <h2>Game Overview</h2>
            <p>Welcome to Tree Planting AR! Help us reforest the world. Choose an area, select a tree, and plant it. Your contributions are recorded on the blockchain, and our AI helps you choose the best trees for each environment.</p>
        </section>

        <section id="game-controls" style="text-align: center; margin-bottom: 20px;">
            <label for="area-select">Choose Area:</label>
            <select id="area-select" onchange="changeArea()">
                <option value="forest">Forest</option>
                <option value="desert">Desert</option>
                <option value="city">City</option>
            </select>

            <label for="tree-select">Choose Tree:</label>
            <select id="tree-select">
                <option value="oak">Oak</option>
                <option value="pine">Pine</option>
                <option value="palm">Palm</option>
                <option value="cactus">Cactus</option>
            </select>
        </section>

        <section id="game-scene" style="height: 500px; position: relative;">
            <h3>Game Scene (AR/VR)</h3>
            <a-scene embedded style="height: 100%; width: 100%;">
                <a-sky id="sky" color="#87CEEB"></a-sky>
                <a-plane id="ground" position="0 0 -4" rotation="-90 0 0" width="10" height="10" color="#7BC8A4"></a-plane>

                <!-- Container for planted trees -->
                <a-entity id="tree-container"></a-entity>

                <a-entity camera look-controls position="0 1.6 0">
                    <a-cursor fuse="false" color="red"></a-cursor>
                </a-entity>
            </a-scene>
            <p style="text-align: center; font-style: italic;">Click on the ground to plant a tree. Enter VR mode or use your mouse to look around.</p>
        </section>

        <section id="ai-assistant">
            <h3>AI Planting Assistant</h3>
            <p>Get tips from our AI on where and what to plant.</p>
            <button onclick="getAiRecommendation()">Get Recommendation</button>
            <p><strong>AI Recommendation:</strong> <span id="ai-action"></span></p>
        </section>

        <section id="blockchain-reward">
            <h3>Claim Your Reforestation Reward</h3>
            <p>For every 5 trees planted, you can claim a unique "Guardian of the Earth" NFT.</p>
            <p>Trees planted: <span id="tree-count">0</span></p>
            <input type="text" id="wallet-address" placeholder="Enter Wallet Address (0x...)">
            <button id="claim-button" onclick="claimReward()" disabled>Claim NFT</button>
            <div id="reward-status"></div>
        </section>

        <section id="nft-viewer">
            <h3>NFT Viewer</h3>
            <p>Enter your reward token ID to view your achievement.</p>
            <input type="number" id="nft-token-id" placeholder="Enter Token ID">
            <button onclick="getNftDetails()">View NFT</button>
            <div id="nft-details"></div>
        </section>
    </main>
    <footer>
        <p>&copy; 2024 Games Universe</p>
    </footer>
    <script src="modal.js" defer></script>
    <script>
        const API_KEY = "test-api-key";
        let plantedTrees = 0;

        function changeArea() {
            const area = document.getElementById('area-select').value;
            const ground = document.getElementById('ground');
            const sky = document.getElementById('sky');

            if (area === 'forest') {
                ground.setAttribute('color', '#228B22');
                sky.setAttribute('color', '#87CEEB');
            } else if (area === 'desert') {
                ground.setAttribute('color', '#EDC9AF');
                sky.setAttribute('color', '#FFD700');
            } else if (area === 'city') {
                ground.setAttribute('color', '#808080');
                sky.setAttribute('color', '#B0C4DE');
            }
            getAiRecommendation();
        }

        document.getElementById('ground').addEventListener('click', function (evt) {
            const treeType = document.getElementById('tree-select').value;
            const intersection = evt.detail.intersection.point;
            plantTree(treeType, intersection);
        });

        function plantTree(type, position) {
            const container = document.getElementById('tree-container');
            const tree = document.createElement('a-entity');
            tree.setAttribute('position', position);

            // Simple tree model using primitives
            const trunk = document.createElement('a-cylinder');
            trunk.setAttribute('radius', '0.1');
            trunk.setAttribute('height', '0.5');
            trunk.setAttribute('color', 'brown');
            trunk.setAttribute('position', '0 0.25 0');
            tree.appendChild(trunk);

            const foliage = document.createElement('a-cone');
            foliage.setAttribute('radius-bottom', '0.4');
            foliage.setAttribute('height', '0.8');
            foliage.setAttribute('position', '0 0.8 0');

            if (type === 'oak') foliage.setAttribute('color', 'green');
            else if (type === 'pine') foliage.setAttribute('color', '#013220');
            else if (type === 'palm') {
                foliage.setAttribute('radius-bottom', '0.5');
                foliage.setAttribute('height', '0.2');
                foliage.setAttribute('color', '#32CD32');
            }
            else if (type === 'cactus') {
                 foliage.setAttribute('radius-bottom', '0.15');
                 foliage.setAttribute('height', '0.6');
                 foliage.setAttribute('color', '#2E8B57');
                 foliage.setAttribute('position', '0 0.5 0');
            }

            tree.appendChild(foliage);
            container.appendChild(tree);

            plantedTrees++;
            document.getElementById('tree-count').textContent = plantedTrees;
            if (plantedTrees >= 5) {
                document.getElementById('claim-button').disabled = false;
            }
        }

        async function getAiRecommendation() {
            const area = document.getElementById('area-select').value;
            const response = await fetch('/api/tree_planting/ai/action', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-API-Key': API_KEY
                },
                body: JSON.stringify({ game_state: 'choosing_tree', area: area })
            });
            const data = await response.json();
            document.getElementById('ai-action').textContent = data.action;
        }

        async function claimReward() {
            const address = document.getElementById('wallet-address').value;
            if (!address) {
                alert('Please enter a wallet address.');
                return;
            }
            const response = await fetch('/api/tree_planting/reward', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-API-Key': API_KEY
                },
                body: JSON.stringify({
                    owner_address: address,
                    metadata_uri: "https://games-universe.com/rewards/tree_guardian.json"
                })
            });
            const data = await response.json();
            const statusDiv = document.getElementById('reward-status');
            if (response.ok) {
                statusDiv.innerHTML = `<p style="color: green;">Success! Token ID: ${data.token_id} minted to ${data.owner}</p>`;
                plantedTrees = 0;
                document.getElementById('tree-count').textContent = plantedTrees;
                document.getElementById('claim-button').disabled = true;
            } else {
                statusDiv.innerHTML = `<p style="color: red;">Error claiming reward.</p>`;
            }
        }

        async function getNftDetails() {
            const tokenId = document.getElementById('nft-token-id').value;
            if (!tokenId) {
                alert('Please enter a token ID.');
                return;
            }
            const response = await fetch(`/api/tree_planting/nft/${tokenId}`, {
                headers: {
                    'X-API-Key': API_KEY
                }
            });
            const nftDetailsDiv = document.getElementById('nft-details');
            if (response.ok) {
                const data = await response.json();
                nftDetailsDiv.innerHTML = `
                    <p><strong>Owner:</strong> ${data.owner}</p>
                    <p><strong>Metadata URI:</strong> <a href="${data.uri}" target="_blank">${data.uri}</a></p>
                `;
            } else {
                nftDetailsDiv.innerHTML = `<p style="color: red;">Error: NFT not found.</p>`;
            }
        }

        window.onload = getAiRecommendation;
    </script>
</body>
</html>
