<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shovel Master AR/VR Game - Games Universe</title>
    <meta name="description" content="Experience Shovel Master, an AR/VR game where you fill dump trucks using AI and blockchain technology.">
    <meta name="keywords" content="AR game, VR game, Shovel Master, dump truck, blockchain, AI, game development">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="modal.css">
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
</head>
<body>
    <header>
        <h1>Shovel Master AR/VR Game</h1>
    </header>
    <nav>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="vrar_games.html">AR/VR Games</a></li>
            <li><a href="ai_mmo_games.html">AI MMO Games</a></li>
            <li><a href="paywell.html">Paywell Wallet</a></li>
            <li><a href="shovel_master_game.html">Shovel Master</a></li>
        </ul>
    </nav>
    <main>
        <section id="game-overview">
            <h2>Game Overview</h2>
            <p>Welcome to Shovel Master! In this immersive AR/VR experience, your task is to fill a dump truck using a shovel. Precision and speed are key. Once you fill the truck, you'll be rewarded with a unique blockchain asset.</p>
        </section>

        <section id="game-scene" style="height: 500px; position: relative;">
            <h3>Game Scene (AR/VR)</h3>
            <a-scene embedded style="height: 100%; width: 100%;">
                <a-sky color="#87CEEB"></a-sky>
                <a-plane position="0 0 -4" rotation="-90 0 0" width="10" height="10" color="#7BC8A4"></a-plane>

                <!-- Dump Truck (Simplified) -->
                <a-entity id="truck" position="2 0.5 -5">
                    <a-box position="0 0.5 0" width="2" height="1" depth="4" color="yellow"></a-box>
                    <a-box position="0 1.5 1.5" width="1.8" height="1" depth="1" color="black"></a-box> <!-- Cabin -->
                    <a-box id="truck-bed" position="0 1.2 -0.5" width="1.8" height="0.8" depth="2.8" color="orange"></a-box>
                    <a-cylinder position="-1 0 1.5" rotation="0 0 90" radius="0.4" height="0.2" color="black"></a-cylinder>
                    <a-cylinder position="1 0 1.5" rotation="0 0 90" radius="0.4" height="0.2" color="black"></a-cylinder>
                    <a-cylinder position="-1 0 -1.5" rotation="0 0 90" radius="0.4" height="0.2" color="black"></a-cylinder>
                    <a-cylinder position="1 0 -1.5" rotation="0 0 90" radius="0.4" height="0.2" color="black"></a-cylinder>
                </a-entity>

                <!-- Shovel (Simplified) -->
                <a-entity id="shovel" position="0 1 -3" rotation="0 45 0" class="clickable" onclick="handleShovelClick()">
                    <a-cylinder position="0 0 0" radius="0.05" height="1.5" color="brown"></a-cylinder>
                    <a-box position="0 -0.7 0" width="0.4" height="0.1" depth="0.5" color="silver"></a-box>
                    <a-animation attribute="position" to="1 1 -4" dur="1000" begin="move"></a-animation>
                </a-entity>

                <a-entity camera look-controls position="0 1.6 0">
                    <a-cursor fuse="false" color="red"></a-cursor>
                </a-entity>
            </a-scene>
            <p style="text-align: center; font-style: italic;">Enter VR mode or use your mouse to look around.</p>
        </section>

        <section id="core-features">
            <h3>Core Features</h3>
            <ul>
                <li><strong>AR/VR Immersion:</strong> Use your hands (in VR) or your phone (in AR) to control the shovel and interact with the environment.</li>
                <li><strong>AI Assistance:</strong> Our AI engine helps you optimize your shoveling technique and provides real-time feedback.</li>
                <li><strong>Blockchain Rewards:</strong> Successfully filling a truck mints a unique NFT as a proof of achievement.</li>
                <li><strong>Physics-Based Gameplay:</strong> Realistic dirt and shovel physics for a truly satisfying experience.</li>
            </ul>
        </section>

        <section id="ai-demo">
            <h3>AI Shoveling Assistant</h3>
            <p>Test the Shovel Master AI by simulating different game states.</p>
            <button onclick="getAiAction('shovel_ready')">Shovel is ready</button>
            <button onclick="getAiAction('shovel_full')">Shovel is full</button>
            <button onclick="getAiAction('truck_full')">Truck is full</button>
            <button onclick="getAiAction('idle')">Idle</button>
            <p><strong>AI Recommendation:</strong> <span id="ai-action"></span></p>
        </section>

        <section id="blockchain-reward">
            <h3>Claim Your Reward</h3>
            <p>If you've filled the truck, enter your wallet address to claim your NFT reward.</p>
            <input type="text" id="wallet-address" placeholder="Enter Wallet Address (0x...)">
            <button onclick="claimReward()">Claim NFT</button>
            <div id="reward-status"></div>
        </section>

        <section id="nft-viewer">
            <h3>NFT Viewer</h3>
            <p>Enter your reward token ID to view your achievement.</p>
            <input type="number" id="nft-token-id" placeholder="Enter Token ID">
            <button onclick="getNftDetails()">View NFT</button>
            <div id="nft-details"></div>
        </section>
    </main>
    <footer>
        <p>&copy; 2024 Games Universe</p>
    </footer>
    <script src="modal.js" defer></script>
    <script>
        const API_KEY = "test-api-key";
        let gameState = 'idle';

        function handleShovelClick() {
            const shovel = document.getElementById('shovel');
            if (gameState === 'idle') {
                gameState = 'shoveling';
                shovel.setAttribute('position', '0 0.5 -3');
                updateAiRecommendation('shoveling');
            } else if (gameState === 'shoveling') {
                gameState = 'dumping';
                shovel.setAttribute('position', '1.5 1.5 -4.5');
                updateAiRecommendation('dumping');
                setTimeout(() => {
                    gameState = 'idle';
                    shovel.setAttribute('position', '0 1 -3');
                    updateAiRecommendation('idle');
                    alert("Dirt dumped into truck!");
                }, 2000);
            }
        }

        async function updateAiRecommendation(state) {
            const response = await fetch('/api/shovel_master/ai/action', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-API-Key': API_KEY
                },
                body: JSON.stringify({ game_state: state })
            });
            const data = await response.json();
            document.getElementById('ai-action').textContent = data.action;
        }

        async function getAiAction(state) {
            gameState = state;
            await updateAiRecommendation(state);
        }

        async function claimReward() {
            const address = document.getElementById('wallet-address').value;
            if (!address) {
                alert('Please enter a wallet address.');
                return;
            }
            const response = await fetch('/api/shovel_master/reward', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-API-Key': API_KEY
                },
                body: JSON.stringify({
                    owner_address: address,
                    metadata_uri: "https://games-universe.com/rewards/shovel_master_gold.json"
                })
            });
            const data = await response.json();
            const statusDiv = document.getElementById('reward-status');
            if (response.ok) {
                statusDiv.innerHTML = `<p style="color: green;">Success! Token ID: ${data.token_id} minted to ${data.owner}</p>`;
            } else {
                statusDiv.innerHTML = `<p style="color: red;">Error claiming reward.</p>`;
            }
        }

        async function getNftDetails() {
            const tokenId = document.getElementById('nft-token-id').value;
            if (!tokenId) {
                alert('Please enter a token ID.');
                return;
            }
            const response = await fetch(`/api/shovel_master/nft/${tokenId}`, {
                headers: {
                    'X-API-Key': API_KEY
                }
            });
            const nftDetailsDiv = document.getElementById('nft-details');
            if (response.ok) {
                const data = await response.json();
                nftDetailsDiv.innerHTML = `
                    <p><strong>Owner:</strong> ${data.owner}</p>
                    <p><strong>Metadata URI:</strong> <a href="${data.uri}" target="_blank">${data.uri}</a></p>
                `;
            } else {
                nftDetailsDiv.innerHTML = `<p style="color: red;">Error: NFT not found.</p>`;
            }
        }
    </script>
</body>
</html>
