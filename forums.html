<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forums - Game Development and Research Community - Games Universe</title>
    <meta name="description" content="Join the Games Universe forums to discuss game development, research, and collaborate with a global community of developers, researchers, and companies.">
    <meta name="keywords" content="game development forums, game research community, gamedev, indie games, AI in games, game design">
    <link rel="stylesheet" href="style.css">
    <style>
        .forum-topic {
            border: 1px solid #ccc;
            padding: 15px;
            margin-bottom: 15px;
        }
        .forum-reply {
            border-top: 1px solid #eee;
            padding: 10px;
            margin-top: 10px;
            margin-left: 20px;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1 class="logo">Games Universe</h1>
            <nav>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="games.html">Games</a></li>
                    <li><a href="ai_agent.html">AI Assistant</a></li>
                    <li><a href="developers.html">Developers</a></li>
                    <li><a href="forums.html">Forums</a></li>
                    <li><a href="sponsorship.html">Sponsor Us</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <div class="container">
            <h2>Community Forums</h2>
            <div id="forum-topics"></div>

            <hr>

            <h3>Create a New Topic</h3>
            <form id="new-topic-form">
                <input type="text" id="new-topic-title" placeholder="Topic Title" required>
                <input type="text" id="new-topic-author" placeholder="Your Name" required>
                <textarea id="new-topic-content" placeholder="Your message..." required></textarea>
                <button type="submit">Create Topic</button>
            </form>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2024 Games Universe. All rights reserved.</p>
        </div>
    </footer>

    <script>
        const API_KEY = "test-api-key";
        const API_URL = "http://localhost:8000/api";

        async function fetchTopics() {
            const response = await fetch(`${API_URL}/forums`, {
                headers: { "X-API-Key": API_KEY }
            });
            const topics = await response.json();
            displayTopics(topics);
        }

        function displayTopics(topics) {
            const topicsContainer = document.getElementById('forum-topics');
            topicsContainer.innerHTML = '';
            topics.forEach(topic => {
                const topicElement = document.createElement('div');
                topicElement.className = 'forum-topic';
                topicElement.innerHTML = `
                    <h3>${topic.title}</h3>
                    <p>by <strong>${topic.author}</strong> on ${new Date(topic.timestamp).toLocaleString()}</p>
                    <div class="replies">
                        ${topic.replies.map(reply => `
                            <div class="forum-reply">
                                <p><strong>${reply.author}</strong> on ${new Date(reply.timestamp).toLocaleString()}</p>
                                <p>${reply.content}</p>
                            </div>
                        `).join('')}
                    </div>
                    <form class="reply-form" data-topic-id="${topic.id}">
                        <input type="text" class="reply-author" placeholder="Your Name" required>
                        <textarea class="reply-content" placeholder="Your reply..." required></textarea>
                        <button type="submit">Add Reply</button>
                    </form>
                `;
                topicsContainer.appendChild(topicElement);
            });
        }

        document.getElementById('new-topic-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const title = document.getElementById('new-topic-title').value;
            const author = document.getElementById('new-topic-author').value;
            const content = document.getElementById('new-topic-content').value;

            const newTopic = {
                id: Date.now(),
                title: title,
                author: author,
                timestamp: new Date().toISOString(),
                replies: [{
                    author: author,
                    timestamp: new Date().toISOString(),
                    content: content
                }]
            };

            await fetch(`${API_URL}/forums`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-API-Key': API_KEY
                },
                body: JSON.stringify(newTopic)
            });

            fetchTopics();
        });

        document.getElementById('forum-topics').addEventListener('submit', async (e) => {
            if (e.target.classList.contains('reply-form')) {
                e.preventDefault();
                const topicId = e.target.dataset.topicId;
                const author = e.target.querySelector('.reply-author').value;
                const content = e.target.querySelector('.reply-content').value;

                const newReply = {
                    author: author,
                    timestamp: new Date().toISOString(),
                    content: content
                };

                await fetch(`${API_URL}/forums/${topicId}/replies`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': API_KEY
                    },
                    body: JSON.stringify(newReply)
                });

                fetchTopics();
            }
        });

        window.onload = fetchTopics;
    </script>
</body>
</html>
